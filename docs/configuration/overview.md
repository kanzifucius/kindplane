# Configuration Overview

kindplane uses a YAML configuration file (`kindplane.yaml`) to define your cluster setup.

## Generating Configuration

Create a new configuration file with defaults:

```bash
kindplane init
```

To use a custom filename:

```bash
kindplane init --output my-config.yaml
```

## Configuration Structure

The configuration file has the following top-level sections:

```yaml
cluster:      # Kind cluster configuration
crossplane:   # Crossplane installation settings
credentials:  # Cloud provider credentials
charts:       # Helm charts to install
compositions: # Crossplane compositions to apply
```

## IDE Support

kindplane provides a JSON Schema for configuration validation and IDE autocomplete.

### Automatic Schema Detection

Files generated by `kindplane init` include a schema reference:

```yaml
# yaml-language-server: $schema=https://raw.githubusercontent.com/kanzifucius/kindplane/main/kindplane.schema.json
```

### VS Code / Cursor Setup

1. Install the [YAML extension](https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml)
2. The schema comment enables:
    - Autocomplete for all options
    - Inline documentation on hover
    - Real-time validation

### Manual Schema Association

Add the schema comment to existing files:

```yaml
# yaml-language-server: $schema=https://raw.githubusercontent.com/kanzifucius/kindplane/main/kindplane.schema.json
cluster:
  name: my-cluster
```

Or configure in VS Code settings:

```json
{
  "yaml.schemas": {
    "https://raw.githubusercontent.com/kanzifucius/kindplane/main/kindplane.schema.json": "kindplane.yaml"
  }
}
```

## Validating Configuration

Validate your configuration without creating a cluster:

```bash
kindplane validate
```

Or validate a specific file:

```bash
kindplane validate --config my-config.yaml
```

## Using a Custom Configuration

Specify a configuration file for any command:

```bash
kindplane up --config my-config.yaml
kindplane status --config my-config.yaml
kindplane down --config my-config.yaml --force
```

## Complete Example

Here's a complete configuration example:

```yaml
# yaml-language-server: $schema=https://raw.githubusercontent.com/kanzifucius/kindplane/main/kindplane.schema.json

cluster:
  name: kindplane-dev
  kubernetesVersion: "1.29.0"
  nodes:
    controlPlane: 1
    workers: 1
  portMappings:
    - containerPort: 80
      hostPort: 8080
      protocol: TCP
    - containerPort: 443
      hostPort: 8443
      protocol: TCP
  ingress:
    enabled: true

crossplane:
  version: "1.15.0"
  providers:
    - name: provider-aws
      package: xpkg.upbound.io/upbound/provider-aws:v1.1.0
    - name: provider-kubernetes
      package: xpkg.upbound.io/crossplane-contrib/provider-kubernetes:v0.12.0

credentials:
  aws:
    source: env
  kubernetes:
    source: incluster

charts:
  # Example: Install External Secrets Operator
  - name: external-secrets
    repo: https://charts.external-secrets.io
    chart: external-secrets
    version: "0.9.11"
    namespace: external-secrets
    phase: post-providers
    values:
      installCRDs: true
  - name: cert-manager
    repo: https://charts.jetstack.io
    chart: cert-manager
    namespace: cert-manager
    version: "1.14.0"
    phase: pre-crossplane
    values:
      installCRDs: true

compositions:
  sources:
    - path: ./compositions
```

## Configuration Sections

| Section | Description | Required |
|---------|-------------|----------|
| [cluster](cluster.md) | Kind cluster settings | Yes |
| [cluster.registry](cluster.md#registry) | Local container registry | No |
| [cluster.trustedCAs](trusted-cas.md) | Trusted CA certificates | No |
| [crossplane](crossplane.md) | Crossplane installation | Yes |
| [crossplane.providers](providers.md) | Crossplane providers | No |
| [credentials](credentials.md) | Cloud provider credentials | No |
| [charts](charts.md) | Helm charts to install | No |
| [compositions](compositions.md) | Crossplane compositions | No |

!!! note "External Secrets Operator"
    ESO can be installed via the `charts` section. See the [ESO guide](eso.md) for details.
